<html>
<head>

  <!-- dot demoparty intro -->

  <title>Seems Legit</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">

  <!-- includes here -->

  <script type="text/javascript" src="lib/pixi.dev.js"></script>
  <script type="text/javascript" src="lib/pt.js"></script>
  <script type="text/javascript" src="util.js"></script>

<script type='text/javascript'>

  // globals
  var canvas;
  var renderer;
  var stage;
  var audio;
  var fft;
  var pt;

  // intro 'control' goes here, timing of scenes etc.

  function introInit() {
    // init audio
    pt = new Protracker();
    pt.load('files/kakofonia.mod');
    pt.onReady = function() {
      console.log('ProTracker module ' + pt.title + ' loaded.');
      if (pt.context==null) pt.createContext();
      var analyser = pt.context.createAnalyser();
      analyser.smoothingTimeConstant = 0.3;
      analyser.fftSize = 2048;
      pt.compressorNode.connect(analyser);
      fft = new Uint8Array(analyser.frequencyBinCount);

      // init canvas
      canvas = document.getElementById('c');
      renderer = PIXI.autoDetectRenderer(window.innerWidth, window.innerHeight, canvas, false); // view, transparent
      stage = new PIXI.Stage( 0xee0066, false ); // bgcol, interactive

      var texture = PIXI.Texture.fromImage("files/bunny.png");
      var bunny = new PIXI.Sprite(texture);

      bunny.anchor.x = 0.5;
      bunny.anchor.y = 0.5;
      bunny.scale.x = bunny.scale.y = 1;

      bunny.position.x = 50;
      bunny.position.y = 50;

      stage.addChild(bunny);
      console.log(pt.context.currentTime);
      pt.play();
      console.log(pt.context.currentTime);

      document.onkeypress = function(e) {
        switch(e.charCode) {
          case 32:
            if (pt.paused) {
              pt.play();
              console.log('playing mod');
            } else {
              pt.pause();
              console.log('paused mod');
            }
        }
      }

      render();
    };
  }

  function render() {
    window.requestAnimationFrame( render );
    renderer.render( stage );
  }

</script>
</head>

<body onload='introInit();'>
  <canvas id="c" style="position:absolute; left:0px; top:0px; margin:0px; padding:0px;"></canvas>
</body>
</html>

